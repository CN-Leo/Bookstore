<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta name="viewport"
	content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<meta http-equiv="Access-Control-Allow-Origin" content="*">
<meta content="telephone=no" name="format-detection">
<meta http-equiv="Content-Type" content="multipart/form-data; charset=utf-8" />
<meta content="email=no" name="format-detection">
<link rel="stylesheet" type="text/css" href="libs/bootstrap-3.3.7/css/bootstrap.min.css" />
<link rel="stylesheet" href="libs/bootstrap-table/bootstrap-table.min.css" />
<link rel="stylesheet" type="text/css" href="libs/uploadify/uploadify.css" />
<link rel="stylesheet" type="text/css" href="css/H-ui.min.css" />
<link rel="stylesheet" type="text/css" href="css/H-ui.admin.css" />
<link rel="stylesheet" type="text/css" href="css/H-ui.doc.css" />
<link rel="stylesheet" type="text/css" href="Hui-iconfont108/iconfont.css">
<link rel="stylesheet" href="css/main.css" />
<script type="text/javascript" src="js/jquery.min.js"></script>
<title>药品管理系统后台</title>
<style>
.form .row {
    margin-top: 5px;
}
label {font-weight: 500;}
.file-a{background:green;display: block;width: 80px;height:25px;line-height:25px;
    		color:#fff;font-weight:500;margin-bottom:5px;border-radius: 1px;}
.file-a:hover,.file-a:focus{background:green;color:#fff;outline:none;text-decoration: none;}
.file-span{position: absolute;left: 25px;}
input[type=file] {display:inline;width:80px;height:25px;opacity: 0;margin-top:-3px}
</style>
</head>
<body>
	<header class="navbar-wrapper">
		<div class="navbar navbar-black">
			<div class="container-fluid cl">
				<a class="logo navbar-logo hidden-xs" href="index.html">药品智能平台</a>
				<nav class="navbar-userbar f-r hidden-xs hidden-sm">
					<ul class="cl">
						<li class="dropDown dropDown_hover"><a href="#"
							class="dropDown_A"><span id="account"></span><i
								class="Hui-iconfont"></i></a>
							<ul class="dropDown-menu menu radius box-shadow">
								<li class=""><a href="javascript:void(0)"
									onclick="updatepassword()">修改密码</a></li>
								<li><a href="javascript:void(0)" onclick="loginOut()">退出登录</a>
								</li>
							</ul></li>

					</ul>
				</nav>
			</div>
		</div>
	</header>
	<aside class="Hui-aside">
		<div class="menu_dropdown bk_2">
			<ul>
				<li><a href="user.html">用户管理</a></li>
			</ul>
			<ul>
				<li><a href="admin.html">管理员管理</a></li>
			</ul>
			<ul>
				<li><a href="drug.html" class="_target">药品管理</a></li>
			</ul>
			<ul>
				<li><a href="firm.html">厂家管理</a></li>
			</ul>
			<dl id="menu_2">
				<dt class="">
					主菜单<i class="Hui-iconfont menu_dropdown-arrow"></i>
				</dt>
				<dd style="display: none;">
					<ul>
						<li><a href="http://www.h-ui.net/Hui-2.1-gridSystem.shtml">副菜单1</a></li>
						<li><a href="http://www.h-ui.net/Hui-2.2-show&amp;hide.shtml">副菜单2</a></li>
					</ul>
				</dd>
			</dl>
		</div>
	</aside>
	<div class="dislpayArrow hidden-xs">
		<a class="pngfix" href="javascript:void(0);"
			onClick="displaynavbar(this)"></a>
	</div>
	<section class="Hui-article-box">
		<nav class="breadcrumb">
			<a class="maincolor" href="drug.html">药品管理</a> <span class="c-999 en">&gt;</span>
			<span class="c-666">新增药品</span>
		</nav>
		<div class="Hui-article">
			<article class="page-container">
				<form class="form form-horizontal">
					<div class="row cl">
						<label class="form-label  col-sm-2"><span class="c-red">*</span>药品名：</label>
						<div class="formControls  col-sm-4">
							<input type="text" class="input-text" value="" placeholder="药品名"
								id="fDrugName">
						</div>
					</div>
					<div class="row cl">
						<label class="form-label  col-sm-2"><span class="c-red">*</span>药品分类：</label>
						<div class="formControls  col-sm-4">
							<select
								class="select-box select" id="fDrugType" size="1">
									<option value="1">解热镇痛药</option>
									<option value="2">循环系统</option>
									<option value="3">妇科用药</option>
									<option value="4">皮肤科用</option>
									<option value="5">动物类</option>
									<option value="6">矿物类</option>
									<option value="7">I类器材</option>
									<option value="8">II类器材</option>
									<option value="9">辅助用品</option>
									<option value="10">避孕用品</option>
									<option value="11">改善促进</option>
									<option value="12">排毒养颜</option>
							</select>
						</div>
					</div>
					<div class="row cl">
						<label class="form-label  col-sm-2"><span class="c-red">*</span>药品成分：</label>
						<div class="formControls  col-sm-4">
							<select class="select-box select" id="fDrugModel" size="1">
									<option value="0">中药</option>
									<option value="1">西药</option>
									<option value="2">复方药</option>
							</select>
						</div>
					</div>
					<div class="row cl">
						<label class="form-label  col-sm-2"><span class="c-red">*</span>处方药：</label>
						<div class="formControls  col-sm-4">
							<select class="select-box select" id="fIsPrescription" size="1">
									<option value="0">非处方</option>
									<option value="1">处方</option>
							</select>
						</div>
					</div>
					<div class="row cl">
						<label class="form-label  col-sm-2"><span class="c-red">*</span>价格(元)：</label>
						<div class="formControls  col-sm-4">
							<input type="number" class="input-text" style="width:100%" value="" placeholder=""
								id="fDrugPrice" >
						</div>
					</div>
					<div class="row cl">
						<label class="form-label  col-sm-2"><span class="c-red">*</span>库存：</label>
						<div class="formControls  col-sm-4">
							<input type="number" class="input-text" style="width:100%" value="" placeholder=""
								id="fStock">
						</div>
					</div>
					<div class="row cl">
						<label class="form-label  col-sm-2"><span class="c-red">*</span>药品图片：</label>
						<div class="formControls  col-sm-8">
							<a class="file-a" href="javascript:void(0)"> <span
								class="file-span">上传封面</span> <input type="file" value="选择文件"
								id="upload-file" onchange="verificationPicFile(this)" accept="image/*"
								title="">
							</a> <img id="fDrugImg"
								style="height: 100px; vertical-align: bottom;" alt=""
								src="" />
						</div>
					</div>
					<div class="row cl">
						<label class="form-label  col-sm-2">备注：</label>
						<div class="formControls  col-sm-4">
							<textarea  class="textarea" id="fContent" placeholder="药品描述" ></textarea>
						</div>
					</div>
					<div class="row cl">
						<div class=" col-sm-8 col-xs-offset-4 col-sm-offset-3">
							<input class="btn btn-primary radius" type="button" onclick="addDrug()"
								value="提交">
						</div>
					</div>
				</form>
			</article>
		</div>
	</section>

	<script type="text/javascript" src="libs/layer/layer.js"></script>
	<script type="text/javascript" src="../script/qm_main.js"></script>
	<script type="text/javascript" src="libs/uploadify/jquery.uploadify.js"></script>
	<script type="text/javascript" src="js/H-ui.min.js"></script>
	<script type="text/javascript" src="js/H-ui.admin.www.js"></script>
	<script type="text/javascript"
		src="libs/bootstrap-table/bootstrap-table.min.js"></script>
	<script type="text/javascript"
		src="libs/bootstrap-table/bootstrap-table-zh-CN.min.js"></script>
	<script type="text/javascript" src="js/login.js"></script>
	<script type="text/javascript" src="js/drug.js"></script>
	<script type="text/javascript">
	isLogin();
	//上传图片
  function uploadFile(){
		//验证图片像素
		var form = new FormData();   
        var fileObj = document.getElementById("upload-file").files[0]; // 获取文件对象  
	    form.append("file", fileObj);
        var FileController = "/manager/upload/uploadDrugImg"; // 接收上传文件的后台地址  
        if(fileObj){
            // FormData 对象  
             var form = new FormData();   
             form.append("file", fileObj);// 文件对象     
             var xhr = new XMLHttpRequest();      
             xhr.open("post", FileController, true);      
             xhr.onload = function () { 
            	//var image=eval("["+xhr.responseText+']')[0];
            	var image=xhr.responseText;
            	$("#fDrugImg").attr("src",image);
            	drug_img = image;
             };   
             xhr.send(form);
        }
    }
	//图片像素验证
  function verificationPicFile(file) {
	    var filePath = file.value;
	    if(filePath){
	        //读取图片数据
	        var filePic = file.files[0];
	        var reader = new FileReader();
	        reader.onload = function (e) {
	            var data = e.target.result;
	            //加载图片获取图片真实宽度和高度
	            var image = new Image();
	            image.onload=function(){
	                var width = image.width;
	                var height = image.height;
	                if (width >= 160 &&width <= 210 && height <= 210&&height >= 160){
	                    //alert("文件尺寸符合！");
	                    uploadFile();
	                }else {
	                    alert("文件尺寸不符合！最小像素为160*160，最大像素为190*190");
	                    file.value = "";
	                    return false;
	                }
	            };
	            image.src= data;
	        };
	        reader.readAsDataURL(filePic);
	    }else{
	        return false;
	    }
	}
//图片大小验证
  function verificationPicFileSize(file) {
      var fileSize = 0;
      var fileMaxSize = 1024;//1M
      var filePath = file.value;
      if(filePath){
          fileSize =file.files[0].size;
          var size = fileSize / 1024;
          if (size > fileMaxSize) {
              alert("文件大小不能大于1M！");
              file.value = "";
              return false;
          }else if (size <= 0) {
              alert("文件大小不能为0M！");
              file.value = "";
              return false;
          }
      }else{
          return false;
      }
  }
//图片类型验证
  function verificationPicFileType(file) {
      var fileTypes = [".jpg", ".png"];
      var filePath = file.value;
      //当括号里面的值为0、空字符、false 、null 、undefined的时候就相当于false
      if(filePath){
          var isNext = false;
          var fileEnd = filePath.substring(filePath.indexOf("."));
          for (var i = 0; i < fileTypes.length; i++) {
              if (fileTypes[i] == fileEnd) {
                  isNext = true;
                  break;
              }
          }
          if (!isNext){
              alert('不接受此文件类型');
              file.value = "";
              return false;
          }
      }else {
          return false;
      }
  }

	</script>
</body>
</html>